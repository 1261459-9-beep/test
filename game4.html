<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å½ˆç æ³¢å­æ©Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #121212;
            font-family: 'Microsoft JhengHei', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .game-container {
            position: relative;
            width: 400px;
            height: 600px;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            border: 3px solid gold;
        }
        
        .pinball-table {
            position: relative;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MDAiIGhlaWdodD0iNjAwIj48cmVjdCB3aWR0aD0iNDAwIiBoZWlnaHQ9IjYwMCIgZmlsbD0icmdiYSgyNTUsMjU1LDI1NSwwLjA1KSIvPjwvc3ZnPg==') repeat;
            overflow: hidden;
        }
        
        .score-board {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            color: gold;
            font-weight: bold;
            z-index: 10;
        }
        
        .score-item {
            text-align: center;
        }
        
        .score-label {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        .score-value {
            font-size: 1.2rem;
        }
        
        .play-area {
            position: absolute;
            top: 60px;
            left: 10px;
            right: 10px;
            bottom: 80px;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            perspective: 1000px;
        }
        
        .flippers {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-around;
        }
        
        .flipper {
            width: 60px;
            height: 20px;
            background: #ff6600;
            border-radius: 10px;
            transform-origin: center bottom;
            transition: transform 0.1s ease;
            cursor: pointer;
        }
        
        .flipper.left {
            transform: rotate(-45deg);
        }
        
        .flipper.right {
            transform: rotate(45deg);
        }
        
        .flipper.active {
            background: #ffcc00;
        }
        
        .ball {
            position: absolute;
            width: 15px;
            height: 15px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
            z-index: 5;
        }
        
        .bumper {
            position: absolute;
            width: 30px;
            height: 30px;
            background: radial-gradient(circle, #ff6600, #ff0000);
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(255, 102, 0, 0.8);
            cursor: pointer;
        }
        
        .target {
            position: absolute;
            width: 25px;
            height: 25px;
            background: linear-gradient(45deg, #00ff00, #00cc00);
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0, 255, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: black;
            cursor: pointer;
        }
        
        .ramp {
            position: absolute;
            background: linear-gradient(to bottom, #ffcc00, #ff9900);
            border-radius: 10px 10px 0 0;
            transform-origin: bottom center;
            cursor: pointer;
        }
        
        .launch-button {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 30px;
            background: #ff6600;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(255, 102, 0, 0.5);
        }
        
        .launch-button:hover {
            background: #ff9900;
        }
        
        .message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 20px 30px;
            border-radius: 15px;
            color: gold;
            font-size: 1.2rem;
            text-align: center;
            z-index: 20;
            display: block;
        }
        
        .controls {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            display: flex;
            justify-content: center;
            gap: 10px;
            color: #ccc;
            font-size: 0.8rem;
        }
        
        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: gold;
            font-size: 2rem;
            font-weight: bold;
            z-index: 30;
            display: none;
        }
        
        .restart-btn {
            margin-top: 20px;
            padding: 10px 20px;
            background: #ff6600;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-weight: bold;
        }
        
        .restart-btn:hover {
            background: #ff9900;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="pinball-table">
            <div class="score-board">
                <div class="score-item">
                    <div class="score-label">åˆ†æ•¸</div>
                    <div class="score-value" id="score">0</div>
                </div>
                <div class="score-item">
                    <div class="score-label">çƒæ•¸</div>
                    <div class="score-value" id="balls">3</div>
                </div>
                <div class="score-item">
                    <div class="score-label">ç­‰ç´š</div>
                    <div class="score-value" id="level">1</div>
                </div>
            </div>
            
            <div class="play-area" id="playArea">
                <!-- å½ˆç æœƒå‹•æ…‹ç”Ÿæˆ -->
            </div>
            
            <div class="flippers">
                <div class="flipper left" id="leftFlipper"></div>
                <div class="flipper right" id="rightFlipper"></div>
            </div>
            
            <div class="launch-button" id="launchButton">ç™¼å°„</div>
            
            <div class="controls">
                <div>â† â†’ æ§åˆ¶æ“‹æ¿ | ç©ºæ ¼éµç™¼å°„</div>
            </div>
            
            <div class="message" id="message">æŒ‰ç©ºæ ¼éµæˆ–é»æ“Šç™¼å°„æŒ‰éˆ•é–‹å§‹éŠæˆ²ï¼</div>
            
            <div class="game-over" id="gameOver">
                <div>éŠæˆ²çµæŸï¼</div>
                <div id="finalScore">æœ€çµ‚åˆ†æ•¸ï¼š0</div>
                <div class="restart-btn" id="restartBtn">é‡æ–°é–‹å§‹</div>
            </div>
        </div>
    </div>

    <script>
        // éŠæˆ²è®Šæ•¸
        let score = 0;
        let ballsLeft = 3;
        let currentLevel = 1;
        let isLaunching = false;
        let ball = null;
        let gameActive = false;
        let gravity = 0.5;
        let friction = 0.98;
        let bounceFactor = 0.8;
        let bumpers = [];
        let targets = [];
        let ramps = [];
        let ballSpeed = { x: 0, y: 0 };
        let ballPos = { x: 0, y: 0 };
        let lastTime = 0;
        let animationId = null;
        let isGameStarted = false;
        let isBallLaunched = false; // ğŸ‘ˆ æ–°å¢ï¼šæ¨™è¨˜æ˜¯å¦å·²ç™¼å°„
    
        // DOM å…ƒç´ ï¼ˆç•¥ï¼Œä¸è®Šï¼‰
    
        // åˆå§‹åŒ–éŠæˆ²
        function initGame() {
            score = 0;
            ballsLeft = 3;
            currentLevel = 1;
            gameActive = true; // éŠæˆ²å®¹å™¨å§‹çµ‚å¯äº’å‹•
            isGameStarted = false;
            isBallLaunched = false; // é‡ç½®ç™¼å°„ç‹€æ…‹
            ball = null;
            ballSpeed = { x: 0, y: 0 };
            ballPos = { x: 0, y: 0 };
    
            updateScore();
            createObstacles();
            showStartMessage();
    
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            // å•Ÿå‹•ä¸»å¾ªç’°ï¼ˆå³ä½¿æœªç™¼å°„ä¹Ÿè¦æª¢æŸ¥è¼¸å…¥ï¼‰
            lastTime = performance.now();
            animate();
        }
    
        // å‰µå»ºéšœç¤™ç‰©ï¼ˆç•¥ï¼Œä¸è®Šï¼‰
    
        // é¡¯ç¤ºé–‹å§‹è¨Šæ¯
        function showStartMessage() {
            messageEl.style.display = 'block';
            messageEl.textContent = 'æŒ‰ç©ºæ ¼éµæˆ–é»æ“Šç™¼å°„æŒ‰éˆ•é–‹å§‹éŠæˆ²ï¼';
            isGameStarted = false;
            isBallLaunched = false;
        }
    
        // é–‹å§‹æ–°ä¸€çƒï¼ˆæº–å‚™ç™¼å°„ï¼‰
        function startNewBall() {
            if (ballsLeft <= 0) return;
    
            messageEl.style.display = 'none';
            isGameStarted = true;
            isBallLaunched = false; // å°šæœªç™¼å°„
    
            // å°‡å½ˆç ç§»åˆ°ç™¼å°„ä½ç½®ï¼ˆåº•éƒ¨ä¸­å¤®ï¼‰
            ballPos = { 
                x: playArea.offsetWidth / 2 - 7.5, 
                y: playArea.offsetHeight - 60 
            };
            if (ball) {
                ball.style.left = ballPos.x + 'px';
                ball.style.top = ballPos.y + 'px';
            }
        }
    
        // ç™¼å°„å½ˆç 
        function launchBall() {
            if (!isGameStarted || isBallLaunched || isLaunching) return;
    
            isLaunching = true;
            isBallLaunched = true; // ğŸ‘ˆ æ¨™è¨˜å·²ç™¼å°„
            // éš¨æ©Ÿä¸€é»æ°´å¹³é€Ÿåº¦ï¼Œé¿å…ç›´ä¸Šç›´ä¸‹
            ballSpeed = { 
                x: (Math.random() - 0.5) * 6, 
                y: -15 
            };
    
            setTimeout(() => {
                isLaunching = false;
            }, 500);
        }
    
        // æ“‹æ¿æ§åˆ¶ï¼ˆç•¥ï¼Œä¸è®Šï¼‰
    
        // çµæŸç•¶å‰çƒï¼ˆæ‰å‡ºåº•éƒ¨ï¼‰
        function loseBall() {
            ballsLeft--;
            updateScore();
    
            if (ballsLeft <= 0) {
                endGame();
            } else {
                messageEl.style.display = 'block';
                messageEl.textContent = 'æŒ‰ç©ºæ ¼éµæˆ–é»æ“Šç™¼å°„æŒ‰éˆ•ç¹¼çºŒï¼';
                isGameStarted = false;
                isBallLaunched = false;
                ballSpeed = { x: 0, y: 0 };
    
                // å½ˆç å›åˆ°åº•éƒ¨ç­‰å¾…ä¸‹æ¬¡ç™¼å°„
                ballPos = { 
                    x: playArea.offsetWidth / 2 - 7.5, 
                    y: playArea.offsetHeight - 60 
                };
                if (ball) {
                    ball.style.left = ballPos.x + 'px';
                    ball.style.top = ballPos.y + 'px';
                }
            }
        }
    
        // ä¸»å‹•ç•«å¾ªç’°
        function animate(timestamp) {
            const deltaTime = timestamp - lastTime;
            lastTime = timestamp;
    
            // æ›´æ–°å½ˆç ä½ç½®ï¼ˆåƒ…åœ¨å·²ç™¼å°„æ™‚ï¼‰
            if (ball && isBallLaunched) {
                // æ‡‰ç”¨é‡åŠ›
                ballSpeed.y += gravity;
                // æ‘©æ“¦
                ballSpeed.x *= friction;
                ballSpeed.y *= friction;
                // æ›´æ–°ä½ç½®
                ballPos.x += ballSpeed.x;
                ballPos.y += ballSpeed.y;
    
                // æª¢æŸ¥é‚Šç•Œèˆ‡ç¢°æ’
                checkBoundaries();
                checkCollisions();
    
                // æ›´æ–°ç•«é¢
                ball.style.left = ballPos.x + 'px';
                ball.style.top = ballPos.y + 'px';
            } else if (ball && !isBallLaunched && isGameStarted) {
                // æœªç™¼å°„ä½†å·²é–‹å§‹ï¼šä¿æŒåœ¨ç™¼å°„ä½ç½®ï¼ˆé˜²æ­¢é‡åŠ›æ‹‰ä¸‹ï¼‰
                ballPos = { 
                    x: playArea.offsetWidth / 2 - 7.5, 
                    y: playArea.offsetHeight - 60 
                };
                ball.style.left = ballPos.x + 'px';
                ball.style.top = ballPos.y + 'px';
            }
    
            animationId = requestAnimationFrame(animate);
        }
    
        // æª¢æŸ¥é‚Šç•Œç¢°æ’
        function checkBoundaries() {
            // å·¦å³
            if (ballPos.x < 0) {
                ballPos.x = 0;
                ballSpeed.x = -ballSpeed.x * bounceFactor;
            } else if (ballPos.x > playArea.offsetWidth - 15) {
                ballPos.x = playArea.offsetWidth - 15;
                ballSpeed.x = -ballSpeed.x * bounceFactor;
            }
    
            // ä¸Š
            if (ballPos.y < 0) {
                ballPos.y = 0;
                ballSpeed.y = -ballSpeed.y * bounceFactor;
            }
    
            // ä¸‹ï¼ˆæ‰è½ï¼‰
            if (ballPos.y > playArea.offsetHeight - 15) {
                loseBall(); // è™•ç†æ‰çƒ
            }
        }
    
        // å…¶ä»–å‡½æ•¸ï¼ˆcheckCollisions, isColliding, handleCollision, hitBumper... ç­‰ä¿æŒä¸è®Šï¼‰
    
        // äº‹ä»¶ç›£è½å™¨
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                if (!isGameStarted) {
                    startNewBall();
                } else {
                    launchBall();
                }
            } else if (e.code === 'ArrowLeft') {
                if (isGameStarted) activateFlipper(leftFlipper, 'left');
            } else if (e.code === 'ArrowRight') {
                if (isGameStarted) activateFlipper(rightFlipper, 'right');
            }
        });
    
        launchButton.addEventListener('click', () => {
            if (!isGameStarted) {
                startNewBall();
            } else {
                launchBall();
            }
        });
    
        // å…¶ä»–äº‹ä»¶ï¼ˆç•¥ï¼‰
    
        // åˆå§‹åŒ–
        initGame();
    </script>
        // åˆå§‹åŒ–éŠæˆ²
        function initGame() {
            score = 0;
            ballsLeft = 3;
            currentLevel = 1;
            gameActive = false;
            isGameStarted = false;
            ball = null;
            ballSpeed = { x: 0, y: 0 };
            ballPos = { x: 0, y: 0 };
            
            updateScore();
            createObstacles();
            showStartMessage();
            
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
        }
        
        // å‰µå»ºéšœç¤™ç‰©
        function createObstacles() {
            // æ¸…é™¤ç¾æœ‰éšœç¤™ç‰©
            // å‰µå»ºå½ˆç 
            if (ball) {
                ball.remove();
                ball = null;
            }
            
            // å‰µå»ºå½ˆç 
            ball = document.createElement('div');
            ball.className = 'ball';
            playArea.appendChild(ball);
            
            // è¨­ç½®åˆå§‹ä½ç½®
            ballPos = { 
                x: playArea.offsetWidth / 2 - 7.5, 
                y: playArea.offsetHeight - 60 
            };
            ball.style.left = ballPos.x + 'px';
            ball.style.top = ballPos.y + 'px';
            
            // å‰µå»ºå½ˆç å°å…ƒç´ 
            createBumpers();
            createTargets();
            createRamps();
        }
        
        // å‰µå»ºå½ˆç 
        function createBumpers() {
            // ä¸Šæ–¹ä¸‰å€‹å½ˆç 
            for (let i = 0; i < 3; i++) {
                const bumper = document.createElement('div');
                bumper.className = 'bumper';
                bumper.style.left = (100 + i * 100) + 'px';
                bumper.style.top = '100px';
                playArea.appendChild(bumper);
                bumper.addEventListener('click', () => hitBumper(bumper));
                bumpers.push(bumper);
            }
            
            // ä¸­é–“å…©å€‹å½ˆç 
            for (let i = 0; i < 2; i++) {
                const bumper = document.createElement('div');
                bumper.className = 'bumper';
                bumper.style.left = (150 + i * 80) + 'px';
                bumper.style.top = '250px';
                playArea.appendChild(bumper);
                bumper.addEventListener('click', () => hitBumper(bumper));
                bumpers.push(bumper);
            }
            
            // ä¸‹æ–¹ä¸€å€‹å½ˆç 
            const bumper = document.createElement('div');
            bumper.className = 'bumper';
            bumper.style.left = '200px';
            bumper.style.top = '400px';
            playArea.appendChild(bumper);
            bumper.addEventListener('click', () => hitBumper(bumper));
            bumpers.push(bumper);
        }
        
        // å‰µå»ºç›®æ¨™
        function createTargets() {
            // å·¦ä¸Šè§’ç›®æ¨™
            const target1 = document.createElement('div');
            target1.className = 'target';
            target1.textContent = '10';
            target1.style.left = '50px';
            target1.style.top = '50px';
            playArea.appendChild(target1);
            target1.addEventListener('click', () => hitTarget(target1, 10));
            targets.push(target1);
            
            // å³ä¸Šè§’ç›®æ¨™
            const target2 = document.createElement('div');
            target2.className = 'target';
            target2.textContent = '20';
            target2.style.right = '50px';
            target2.style.top = '50px';
            playArea.appendChild(target2);
            target2.addEventListener('click', () => hitTarget(target2, 20));
            targets.push(target2);
            
            // ä¸­å¤®ç›®æ¨™
            const target3 = document.createElement('div');
            target3.className = 'target';
            target3.textContent = '30';
            target3.style.left = '180px';
            target3.style.top = '200px';
            playArea.appendChild(target3);
            target3.addEventListener('click', () => hitTarget(target3, 30));
            targets.push(target3);
            
            // ä¸‹æ–¹ç›®æ¨™
            const target4 = document.createElement('div');
            target4.className = 'target';
            target4.textContent = '50';
            target4.style.left = '170px';
            target4.style.top = '350px';
            playArea.appendChild(target4);
            target4.addEventListener('click', () => hitTarget(target4, 50));
            targets.push(target4);
        }
        
        // å‰µå»ºæ–œå¡
        function createRamps() {
            // å·¦å´æ–œå¡
            const ramp1 = document.createElement('div');
            ramp1.className = 'ramp';
            ramp1.style.width = '100px';
            ramp1.style.height = '30px';
            ramp1.style.left = '50px';
            ramp1.style.top = '150px';
            ramp1.style.transform = 'rotate(-20deg)';
            playArea.appendChild(ramp1);
            ramp1.addEventListener('click', () => hitRamp(ramp1));
            ramps.push(ramp1);
            
            // å³å´æ–œå¡
            const ramp2 = document.createElement('div');
            ramp2.className = 'ramp';
            ramp2.style.width = '100px';
            ramp2.style.height = '30px';
            ramp2.style.right = '50px';
            ramp2.style.top = '150px';
            ramp2.style.transform = 'rotate(20deg)';
            playArea.appendChild(ramp2);
            ramp2.addEventListener('click', () => hitRamp(ramp2));
            ramps.push(ramp2);
            
            // åº•éƒ¨æ–œå¡
            const ramp3 = document.createElement('div');
            ramp3.className = 'ramp';
            ramp3.style.width = '200px';
            ramp3.style.height = '20px';
            ramp3.style.left = '100px';
            ramp3.style.bottom = '50px';
            ramp3.style.transform = 'rotate(0deg)';
            playArea.appendChild(ramp3);
            ramp3.addEventListener('click', () => hitRamp(ramp3));
            ramps.push(ramp3);
        }
        
        // æ›´æ–°åˆ†æ•¸é¡¯ç¤º
        function updateScore() {
            scoreEl.textContent = score;
            ballsEl.textContent = ballsLeft;
            levelEl.textContent = currentLevel;
        }
        
        // é¡¯ç¤ºé–‹å§‹è¨Šæ¯
        function showStartMessage() {
            messageEl.style.display = 'block';
            messageEl.textContent = 'æŒ‰ç©ºæ ¼éµæˆ–é»æ“Šç™¼å°„æŒ‰éˆ•é–‹å§‹éŠæˆ²ï¼';
            gameActive = false;
            isGameStarted = false;
        }
        
        // é–‹å§‹éŠæˆ²
        function startGame() {
            if (ballsLeft <= 0) {
                endGame();
                return;
            }
            
            messageEl.style.display = 'none';
            gameActive = true;
            isGameStarted = true;
            ballSpeed = { x: 0, y: 0 };
            
            // å°‡å½ˆç ç§»åˆ°ç™¼å°„ä½ç½®
            ballPos = { 
                x: playArea.offsetWidth / 2 - 7.5, 
                y: playArea.offsetHeight - 60 
            };
            ball.style.left = ballPos.x + 'px';
            ball.style.top = ballPos.y + 'px';
            
            // å•Ÿå‹•å‹•ç•«å¾ªç’°
            lastTime = performance.now();
            animate();
        }
        
        // ç™¼å°„å½ˆç 
        function launchBall() {
            if (!gameActive || isLaunching) return;
            
            isLaunching = true;
            ballSpeed = { x: (Math.random() - 0.5) * 4, y: -15 };
            
            setTimeout(() => {
                isLaunching = false;
            }, 1000);
        }
        
        // æ“‹æ¿æ§åˆ¶
        function activateFlipper(flipper, direction) {
            flipper.classList.add('active');
            if (direction === 'left') {
                flipper.style.transform = 'rotate(-20deg)';
            } else {
                flipper.style.transform = 'rotate(20deg)';
            }
            
            setTimeout(() => {
                flipper.classList.remove('active');
                if (direction === 'left') {
                    flipper.style.transform = 'rotate(-45deg)';
                } else {
                    flipper.style.transform = 'rotate(45deg)';
                }
            }, 200);
        }
        
        // æ’åˆ°å½ˆç 
        function hitBumper(bumper) {
            score += 10;
            updateScore();
            playSound('bumper');
            
            // æ·»åŠ å‹•ç•«æ•ˆæœ
            bumper.style.transform = 'scale(1.2)';
            setTimeout(() => {
                bumper.style.transform = 'scale(1)';
            }, 100);
        }
        
        // æ’åˆ°ç›®æ¨™
        function hitTarget(target, points) {
            score += points;
            updateScore();
            playSound('target');
            
            // æ·»åŠ å‹•ç•«æ•ˆæœ
            target.style.transform = 'scale(1.2)';
            setTimeout(() => {
                target.style.transform = 'scale(1)';
            }, 100);
        }
        
        // æ’åˆ°æ–œå¡
        function hitRamp(ramp) {
            score += 5;
            updateScore();
            playSound('ramp');
            
            // æ·»åŠ å‹•ç•«æ•ˆæœ
            ramp.style.transform = 'scale(1.1) rotate(5deg)';
            setTimeout(() => {
                ramp.style.transform = 'scale(1) rotate(0deg)';
            }, 100);
        }
        
        // æ’åˆ°æ“‹æ¿
        function hitFlipper(flipper, side) {
            score += 2;
            updateScore();
            playSound('flipper');
            
            // æ ¹æ“šæ“‹æ¿æ–¹å‘åå½ˆ
            if (side === 'left') {
                ballSpeed.x = Math.max(-8, ballSpeed.x - 2);
            } else {
                ballSpeed.x = Math.min(8, ballSpeed.x + 2);
            }
            
            // å‘ä¸Šåå½ˆ
            ballSpeed.y = -Math.abs(ballSpeed.y) * 0.8;
        }
        
        // çµæŸéŠæˆ²
        function endGame() {
            gameActive = false;
            isGameStarted = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            
            finalScoreEl.textContent = `æœ€çµ‚åˆ†æ•¸ï¼š${score}`;
            gameOverEl.style.display = 'flex';
        }
        
        // é‡æ–°é–‹å§‹éŠæˆ²
        function restartGame() {
            gameOverEl.style.display = 'none';
            initGame();
        }
        
        // æ’­æ”¾éŸ³æ•ˆ
        function playSound(type) {
            // é€™è£¡å¯ä»¥æ·»åŠ å¯¦éš›éŸ³æ•ˆï¼Œä½†ç‚ºç°¡åŒ–ç¯„ä¾‹ï¼Œåªç”¨ç°¡å–®æç¤º
            console.log(`æ’­æ”¾ ${type} éŸ³æ•ˆ`);
        }
        
        // ä¸»å‹•ç•«å¾ªç’°
        function animate(timestamp) {
            if (!gameActive) return;
            
            const deltaTime = timestamp - lastTime;
            lastTime = timestamp;
            
            // æ›´æ–°å½ˆç ä½ç½®
            if (ball && gameActive) {
                // æ‡‰ç”¨é‡åŠ›
                ballSpeed.y += gravity;
                
                // æ‡‰ç”¨æ‘©æ“¦åŠ›
                ballSpeed.x *= friction;
                ballSpeed.y *= friction;
                
                // æ›´æ–°ä½ç½®
                ballPos.x += ballSpeed.x;
                ballPos.y += ballSpeed.y;
                
                // æª¢æŸ¥é‚Šç•Œç¢°æ’
                checkBoundaries();
                
                // æª¢æŸ¥èˆ‡éšœç¤™ç‰©ç¢°æ’
                checkCollisions();
                
                // æ›´æ–°å½ˆç ä½ç½®
                ball.style.left = ballPos.x + 'px';
                ball.style.top = ballPos.y + 'px';
            }
            
            animationId = requestAnimationFrame(animate);
        }
        
        // æª¢æŸ¥é‚Šç•Œç¢°æ’
        function checkBoundaries() {
            const ballRect = ball.getBoundingClientRect();
            const playAreaRect = playArea.getBoundingClientRect();
            
            // å·¦å³é‚Šç•Œ
            if (ballPos.x < 0) {
                ballPos.x = 0;
                ballSpeed.x = -ballSpeed.x * bounceFactor;
                playSound('wall');
            } else if (ballPos.x > playArea.offsetWidth - 15) {
                ballPos.x = playArea.offsetWidth - 15;
                ballSpeed.x = -ballSpeed.x * bounceFactor;
                playSound('wall');
            }
            
            // ä¸Šé‚Šç•Œ
            if (ballPos.y < 0) {
                ballPos.y = 0;
                ballSpeed.y = -ballSpeed.y * bounceFactor;
                playSound('wall');
            } 
            // ä¸‹é‚Šç•Œï¼ˆæ‰è½ï¼‰
            else if (ballPos.y > playArea.offsetHeight - 15) {
                // å¦‚æœæ‰å‡ºåº•éƒ¨ï¼Œå¤±å»ä¸€é¡†çƒ
                ballsLeft--;
                updateScore();
                
                if (ballsLeft <= 0) {
                    endGame();
                } else {
                    // é‡æ–°é–‹å§‹
                    messageEl.style.display = 'block';
                    messageEl.textContent = 'æŒ‰ç©ºæ ¼éµæˆ–é»æ“Šç™¼å°„æŒ‰éˆ•ç¹¼çºŒï¼';
                    gameActive = false;
                    ballSpeed = { x: 0, y: 0 };
                    
                    // å°‡å½ˆç ç§»å›ç™¼å°„ä½ç½®
                    ballPos = { 
                        x: playArea.offsetWidth / 2 - 7.5, 
                        y: playArea.offsetHeight - 60 
                    };
                    ball.style.left = ballPos.x + 'px';
                    ball.style.top = ballPos.y + 'px';
                }
            }
        }
        
        // æª¢æŸ¥èˆ‡éšœç¤™ç‰©ç¢°æ’
        function checkCollisions() {
            const ballRect = ball.getBoundingClientRect();
            
            // æª¢æŸ¥èˆ‡å½ˆç ç¢°æ’
            bumpers.forEach(bumper => {
                const bumperRect = bumper.getBoundingClientRect();
                if (isColliding(ballRect, bumperRect)) {
                    handleCollision(ballRect, bumperRect);
                    hitBumper(bumper);
                }
            });
            
            // æª¢æŸ¥èˆ‡ç›®æ¨™ç¢°æ’
            targets.forEach(target => {
                const targetRect = target.getBoundingClientRect();
                if (isColliding(ballRect, targetRect)) {
                    handleCollision(ballRect, targetRect);
                    hitTarget(target, parseInt(target.textContent));
                }
            });
            
            // æª¢æŸ¥èˆ‡æ–œå¡ç¢°æ’
            ramps.forEach(ramp => {
                const rampRect = ramp.getBoundingClientRect();
                if (isColliding(ballRect, rampRect)) {
                    handleCollision(ballRect, rampRect);
                    hitRamp(ramp);
                }
            });
            
            // æª¢æŸ¥èˆ‡å·¦æ“‹æ¿ç¢°æ’
            const leftFlipperRect = leftFlipper.getBoundingClientRect();
            if (isColliding(ballRect, leftFlipperRect)) {
                handleCollision(ballRect, leftFlipperRect);
                hitFlipper(leftFlipper, 'left');
            }
            
            // æª¢æŸ¥èˆ‡å³æ“‹æ¿ç¢°æ’
            const rightFlipperRect = rightFlipper.getBoundingClientRect();
            if (isColliding(ballRect, rightFlipperRect)) {
                handleCollision(ballRect, rightFlipperRect);
                hitFlipper(rightFlipper, 'right');
            }
        }
        
        // åˆ¤æ–·æ˜¯å¦ç¢°æ’
        function isColliding(rect1, rect2) {
            return !(
                rect1.right < rect2.left || 
                rect1.left > rect2.right || 
                rect1.bottom < rect2.top || 
                rect1.top > rect2.bottom
            );
        }
        
        // è™•ç†ç¢°æ’
        function handleCollision(ballRect, obstacleRect) {
            // ç°¡å–®ç¢°æ’è™•ç†
            const overlapX = Math.min(ballRect.right - obstacleRect.left, obstacleRect.right - ballRect.left);
            const overlapY = Math.min(ballRect.bottom - obstacleRect.top, obstacleRect.bottom - ballRect.top);
            
            if (overlapX < overlapY) {
                // å·¦å³ç¢°æ’
                if (ballRect.left < obstacleRect.left) {
                    ballPos.x = obstacleRect.left - 15;
                } else {
                    ballPos.x = obstacleRect.right;
                }
                ballSpeed.x = -ballSpeed.x * bounceFactor;
            } else {
                // ä¸Šä¸‹ç¢°æ’
                if (ballRect.top < obstacleRect.top) {
                    ballPos.y = obstacleRect.top - 15;
                } else {
                    ballPos.y = obstacleRect.bottom;
                }
                ballSpeed.y = -ballSpeed.y * bounceFactor;
            }
        }
        
        // äº‹ä»¶ç›£è½å™¨
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                if (!isGameStarted) {
                    startGame();
                } else if (gameActive) {
                    launchBall();
                }
            } else if (e.code === 'ArrowLeft') {
                if (gameActive) {
                    activateFlipper(leftFlipper, 'left');
                }
            } else if (e.code === 'ArrowRight') {
                if (gameActive) {
                    activateFlipper(rightFlipper, 'right');
                }
            }
        });
        
        launchButton.addEventListener('click', () => {
            if (!isGameStarted) {
                startGame();
            } else if (gameActive) {
                launchBall();
            }
        });
        
        leftFlipper.addEventListener('click', () => {
            if (gameActive) {
                activateFlipper(leftFlipper, 'left');
            }
        });
        
        rightFlipper.addEventListener('click', () => {
            if (gameActive) {
                activateFlipper(rightFlipper, 'right');
            }
        });
        
        restartBtn.addEventListener('click', restartGame);
        
        // åˆå§‹åŒ–éŠæˆ²
        initGame();
    </script>
</body>
</html>            bumpers.forEach(b => b.remove());
            targets.forEach(t => t.remove());
            ramps.forEach(r => r.remove());
            bumpers = [];
            targets = [];
            ramps = [];
            
